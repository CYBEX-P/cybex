

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Cybex-P Installation guide &mdash; cybex_web_app 0.9.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
        <script >mermaid.initialize({startOnLoad:true});</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Cybex-P Report Module" href="Cybex-P_Report_Module.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> cybex_web_app
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Front End</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">Web Application</a></li>
</ul>
<p class="caption"><span class="caption-text">Back End</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="The_Cybex-P_Backend.html">The Cybex-P Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cybex-P_Input_Module.html">Cybex-P Input Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cybex-P_API_Module.html">Cybex-P API Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cybex-P_API_Module.html#small-identity-small"><small> Identity </small></a></li>
<li class="toctree-l1"><a class="reference internal" href="Cybex-P_Archive_Module.html">Cybex-P Archive_Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cybex-P_Analytics_Module.html">Cybex-P Analytics Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cybex-P_Report_Module.html">Cybex-P Report_Module</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cybex-P Installation Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cybex.cse.unr.edu/backendapi">Interactive Backend API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">cybex_web_app</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Cybex-P Installation guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/Cybex-P_Installation_Guide.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cybex-p-installation-guide">
<h1>Cybex-P Installation guide<a class="headerlink" href="#cybex-p-installation-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="environment-setup-and-tahoe-installation">
<h2>Environment setup and Tahoe Installation<a class="headerlink" href="#environment-setup-and-tahoe-installation" title="Permalink to this headline">¶</a></h2>
<p>To set up the the Cybex-P backend run the following list of commands.</p>
<p><strong>Note</strong>: Operating System used: Ubuntu (Debian)</p>
<ul class="simple">
<li><p>Create the python environment</p>
<ul>
<li><p>Depdendencys:</p>
<ul>
<li><p>Python3.9</p></li>
<li><p>Python3.9 Headers</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">$:</span> <span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">python3.9</span> <span class="pre">python3.9-dev</span></code></p>
<p><em><strong>NOTE</strong></em>: While it is not required, it is recommended when installing all the Cybex-P modules that each modules should have it’s own virtual environment to hold all of its dependencies.</p>
</div>
<div class="section" id="tahoe-installation-and-setup">
<h2>TAHOE Installation and setup<a class="headerlink" href="#tahoe-installation-and-setup" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Downloading The Tahoe Module Code:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$: `git clone https://github.com/CYBEX-P/tahoe.git`
</pre></div>
</div>
<ul class="simple">
<li><p>Activate the Tahoe virtual environment</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$: `python3.9 -m venv &lt;venv-name&gt;`
$: `source &lt;venv-name&gt;/bin/activate`
(example_name)$: //&lt;------- You should be in your virtual environment now
</pre></div>
</div>
<ul class="simple">
<li><p>For activating on Windows —</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$: `python3.9 -m venv &lt;venv-name&gt;`
$: `&lt;venv-name&gt;/Scripts/activate.bat`
(example_name)$: //&lt;------- You should be in your virtual environment now
</pre></div>
</div>
<ul class="simple">
<li><p>Installing Tahoe Dependencies into Tahoe’s virtual environment</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(example_name) $: `pip install -r  &lt;project-dir&gt;/requirements.txt`
(example_name) $: `cd tahoe`
(example_name) $: `python -m unittest` (optional)
runs unit test (optional)
</pre></div>
</div>
<ul class="simple">
<li><p>Installing  Tahoe</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(example_name) $: `python3.9 setup.py install`
</pre></div>
</div>
<div class="section" id="identity-secret-key">
<h3>Identity Secret Key<a class="headerlink" href="#identity-secret-key" title="Permalink to this headline">¶</a></h3>
<p>Each Cybex-P has a secret key located in Tahoes Identity class that acts a global key for your entire Cybex-P internal system. When Tahoe gets installed on multiple systems across, all those systems that are yours must have the exact same secret key.</p>
<p>To generate this key, do the following:</p>
<ul class="simple">
<li><p>Generate the copy
<code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-c</span> <span class="pre">'import</span> <span class="pre">os;</span> <span class="pre">print(os.urandom(16).hex())</span></code></p></li>
<li><p>This will generate a 16-byte string that will act as your cryptographically secure key.</p></li>
<li><p>For all installation of Tahoe on your internal system, go to the following repository
<code class="docutils literal notranslate"> <span class="pre">tahoe/tahoe/identity/identity.py</span></code></p></li>
<li><p>Within the source code, within the class <code class="docutils literal notranslate"><span class="pre">Identity</span></code>, place replace the value of the varilable <em><strong>secret</strong></em> with your 16-byte string</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Identity</span><span class="p">(</span><span class="n">tahoe</span><span class="o">.</span><span class="n">Object</span><span class="p">):</span>
<span class="o">-</span> <span class="n">Secret</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Your 16-byte string here&quot;&quot;&quot;</span>
</pre></div>
</div>
<p><em><strong>For anything that uses the Tahoe identity module, please change the secret key value to the key you’ve generated</strong></em></p>
</div>
</div>
<div class="section" id="input-module-installation">
<h2><strong>Input Module Installation</strong><a class="headerlink" href="#input-module-installation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Create and activate a python virtual environment</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$: python3.9 -m venv $(example_name)
$: source example_name/bin/activate
(example_name)$:
</pre></div>
</div>
<ul class="simple">
<li><p>Install the module requirements</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(example_name)$:cd cybexp-input
(example_name)$:pip install -r requirements.txt
</pre></div>
</div>
<ul class="simple">
<li><p><em><strong>Configurations</strong></em></p>
<ul>
<li><p>In the root of module/project there will be a <code class="docutils literal notranslate"><span class="pre">config.json</span></code> that has all the database configurations, URLs, and other content related to the database identities. If it is not found or has incorrect configuration parameters, The input module will default to <code class="docutils literal notranslate"><span class="pre">localhost</span></code> database configurations.</p></li>
</ul>
</li>
<li><p>the following is what you’ll see and need to configure within the <code class="docutils literal notranslate"><span class="pre">config.json</span></code>:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>

	<span class="s2">&quot;api&quot;</span> <span class="p">:</span> <span class="p">{</span>
	<span class="s2">&quot;url&quot;</span> <span class="p">:</span> <span class="s2">&quot;https://cybex-api.cse.unr.edu:5000&quot;</span><span class="p">,</span>
	<span class="s2">&quot;host&quot;</span> <span class="p">:</span> <span class="s2">&quot;cybex-api.cse.unr.edu&quot;</span><span class="p">,</span>
	<span class="s2">&quot;port&quot;</span> <span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>
	<span class="s2">&quot;protocol&quot;</span> <span class="p">:</span> <span class="s2">&quot;https&quot;</span><span class="p">,</span>
	<span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="c1">#YOUR API TOKEN GOES HERE</span>
	<span class="p">},</span>

	<span class="s2">&quot;cache&quot;</span> <span class="p">:</span> <span class="p">{</span>
	<span class="s2">&quot;mongo_url&quot;</span> <span class="p">:</span> <span class="s2">&quot;mongodb://cici-api/&quot;</span><span class="p">,</span>
	<span class="s2">&quot;db&quot;</span> <span class="p">:</span> <span class="s2">&quot;cache_db&quot;</span><span class="p">,</span>
	<span class="s2">&quot;coll&quot;</span><span class="p">:</span> <span class="s2">&quot;file_entries&quot;</span>
	<span class="p">},</span>

	<span class="s2">&quot;report&quot;</span> <span class="p">:</span> <span class="p">{</span>
	<span class="s2">&quot;mongo_url&quot;</span> <span class="p">:</span> <span class="s2">&quot;mongodb://cici-api/&quot;</span><span class="p">,</span>
	<span class="s2">&quot;db&quot;</span> <span class="p">:</span> <span class="s2">&quot;report_db&quot;</span><span class="p">,</span>
	<span class="s2">&quot;coll&quot;</span><span class="p">:</span> <span class="s2">&quot;instance&quot;</span>
	<span class="p">},</span>

	<span class="s2">&quot;identity&quot;</span> <span class="p">:</span> <span class="p">{</span>
	<span class="s2">&quot;mongo_url&quot;</span> <span class="p">:</span> <span class="s2">&quot;mongodb://cici-api/&quot;</span><span class="p">,</span>
	<span class="s2">&quot;idenity_db&quot;</span> <span class="p">:</span> <span class="s2">&quot;identity_db&quot;</span><span class="p">,</span>
	<span class="s2">&quot;coll&quot;</span><span class="p">:</span> <span class="s2">&quot;instance&quot;</span>
	<span class="p">},</span>

	<span class="s2">&quot;tahoe&quot;</span><span class="p">:</span> <span class="p">{</span>
	<span class="s2">&quot;mongo_url&quot;</span><span class="p">:</span> <span class="s2">&quot;mongodb://mongo1,mongo2,mongo2:27020/?replicaSet=rs0&quot;</span><span class="p">,</span>
	<span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="s2">&quot;tahoe_db&quot;</span><span class="p">,</span>
	<span class="s2">&quot;coll&quot;</span><span class="p">:</span> <span class="s2">&quot;instance&quot;</span>
	<span class="p">},</span>

	<span class="s2">&quot;analytics&quot;</span><span class="p">:</span> <span class="p">{</span>
	<span class="s2">&quot;mongo_url&quot;</span><span class="p">:</span> <span class="s2">&quot;mongodb://mongo1,mongo2,mongo2:27020/?replicaSet=rs0&quot;</span><span class="p">,</span>
	<span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="s2">&quot;tahoe_db&quot;</span><span class="p">,</span>
	<span class="s2">&quot;coll&quot;</span><span class="p">:</span> <span class="s2">&quot;instance&quot;</span>
	<span class="p">},</span>

	<span class="s2">&quot;archive&quot;</span><span class="p">:</span> <span class="p">{</span>
	<span class="s2">&quot;mongo_url&quot;</span><span class="p">:</span> <span class="s2">&quot;mongodb://mongo1,mongo2,mongo2:27020/?replicaSet=rs0&quot;</span><span class="p">,</span>
	<span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="s2">&quot;tahoe_db&quot;</span><span class="p">,</span>
	<span class="s2">&quot;coll&quot;</span><span class="p">:</span> <span class="s2">&quot;instance&quot;</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>this is where the module will fetch data to-and-from in regards to the input configurations and where to send (like in the example above, the backend API, or the localhost API).</p></li>
</ul>
<hr class="docutils" />
<p><big> <em><strong>Before we initialize the Cybex-P Input module, we’ll want to provide some of our own input sources.</strong></em> </big></p>
<ul class="simple">
<li><p>The Identity backend should hold input configs that will be ran on initialization of the input module</p></li>
<li><p>after setting up config.json, use the load config module to use the configured parameters</p></li>
<li><p><em><strong>To configure input configurations, we can accomplished this by using the <code class="docutils literal notranslate"><span class="pre">WebSocketConfig()</span></code> function of the identity module of tahoe.</strong></em></p></li>
<li><p>For a full example of how to set up input configurations, refer to the <a class="reference external" href="https://github.com/CYBEX-P/cybexp-input/blob/farhan/configure_honeypots.py">configure_honeypots</a> script in the Cybex-P Input module. Here we will go how to provide an input configuration to the backend</p></li>
<li><p>Open a blank python file and import the following modules:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tahoe.identity</span> <span class="k">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">Org</span>
<span class="kn">from</span> <span class="nn">tahoe.identity.config</span> <span class="k">import</span> <span class="n">WebSocketConfig</span>
<span class="kn">from</span> <span class="nn">loadconfig</span> <span class="k">import</span> <span class="n">get_identity_backend</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Grab the identity of the backend (These parameters should be adjusted in your <code class="docutils literal notranslate"><span class="pre">config.json</span></code> file)</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_ID_B</span>  <span class="o">=</span>  <span class="n">get_identity_backend</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>grab or create a new user from the backend
<code class="docutils literal notranslate"><span class="pre">user</span>&#160; <span class="pre">=</span>&#160; <span class="pre">_ID_B.find_user(email='exampleuser&#64;unr.edu',</span> <span class="pre">parse=True)</span></code></p></li>
<li><p>grab an organization that user will be appended to
<code class="docutils literal notranslate"><span class="pre">o</span> <span class="pre">=</span> <span class="pre">Org('unr_honeypot',</span> <span class="pre">u,</span> <span class="pre">u,</span> <span class="pre">'UNR</span> <span class="pre">Honeypot')</span></code></p></li>
<li><p>Now we can finally set up and initialize our own input configurations, Your input configurations will vary, but below is the method and an example used to send an input configuration to the backend</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WebSocketConfig</span><span class="p">(</span>
	<span class="s2">&quot;UNR Cowrie Amsterdam&quot;</span><span class="p">,</span>
	<span class="s2">&quot;cowrie&quot;</span><span class="p">,</span>
	<span class="n">o</span><span class="o">.</span><span class="n">_hash</span><span class="p">,</span>
	<span class="s2">&quot;US/Pacific&quot;</span><span class="p">,</span>
	<span class="s2">&quot;ws://134.122.58.51:5000/&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Each parameter is associated with the following:
“UNR Cowrie Amsterdam” = <strong>plugin name</strong>
“cowrie” = <strong>the type tag of this input</strong>
o._hash = <strong>organization id (or just the hash)</strong>
“US/Pacific” = <strong>timezone</strong>
“ws://134.122.58.51:5000/” = <strong>URL / IP of where this input configuration is located</strong></p>
<ul class="simple">
<li><p>Repeat this process for all available input configurations</p></li>
<li><p>To run your Cybex-P Input Module, execute the following command:
<code class="docutils literal notranslate"><span class="pre">python3.9</span> <span class="pre">input.py</span></code> start</p></li>
</ul>
</div>
<div class="section" id="api-module-installation">
<h2><strong>API Module Installation</strong><a class="headerlink" href="#api-module-installation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Basic Installation:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>	- (example_name) $: `cd &lt;project-dir&gt;/...`
	- (example_name) $: `git clone https://github.com/CYBEX-P/cybexp-api.git`
	- (example_name) $: `cd cybexp-api`
	- (example_name) $:`pip install -r requirements.txt`
</pre></div>
</div>
<ul class="simple">
<li><p>Unit testing:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>	- (example_name) $:`cd ../cybexp-api`
	- (example_name) $:`python3.9 -m unittest`
</pre></div>
</div>
<ul class="simple">
<li><p>Test run the environment:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>	<span class="o">-</span> <span class="n">hupper</span> <span class="o">-</span><span class="n">m</span> <span class="n">api</span>
	<span class="o">-</span> <span class="n">curl</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">ping</span>
</pre></div>
</div>
<div class="section" id="running-in-production">
<h3>Running in Production<a class="headerlink" href="#running-in-production" title="Permalink to this headline">¶</a></h3>
<hr class="docutils" />
<p>In production, THe Cybex-P API should be ran in tandem with uwsgi and a reverse-proxy like nginx.</p>
<p>The Cybex-P API module is built on the falcon API framework. To set up the Cybex-P API in tandem with the uwsgi and nginx. Please consult this <a class="reference external" href="https://falcon.readthedocs.io/en/stable/deploy/nginx-uwsgi.html">Falcon API official documentation</a>.</p>
</div>
</div>
<div class="section" id="archive-module-installation">
<h2><strong>Archive Module Installation</strong><a class="headerlink" href="#archive-module-installation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Create and activate a python virtual environment</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$: python3.9 -m venv $(example_name)
$: source example_name/bin/activate
(example_name)$:
</pre></div>
</div>
<ul class="simple">
<li><p>clone the Cybex-P Archive repository</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/CYBEX-P/cybexp-archive.git</span></code></p>
<ul class="simple">
<li><p>Install the requirements</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(example_name)$: cd cybexp-archive
pip install -r requirements.txt
</pre></div>
</div>
<ul class="simple">
<li><p>Run the module</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(example_name)$: python3.9 archive.py
</pre></div>
</div>
</div>
<div class="section" id="analytics-module-installation">
<h2><strong>Analytics Module Installation</strong><a class="headerlink" href="#analytics-module-installation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Create and activate a python virtual environment</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$: python3.9 -m venv $(example_name)
$: source example_name/bin/activate
(example_name)$:
</pre></div>
</div>
<ul class="simple">
<li><p>clone the Cybex-P Archive repository</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/CYBEX-P/cybexp-analytics.git</span></code></p>
<ul class="simple">
<li><p>Install the requirements</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(example_name)$: cd cybexp-analytics
pip install -r requirements.txt
</pre></div>
</div>
<ul class="simple">
<li><p>Run the module</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(example_name)$: python3.9 analytics.py
</pre></div>
</div>
</div>
<div class="section" id="report-module-installation">
<h2><strong>Report Module Installation</strong><a class="headerlink" href="#report-module-installation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Create and activate a python virtual environment</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$: python3.9 -m venv $(example_name)
$: source example_name/bin/activate
(example_name)$:
</pre></div>
</div>
<ul class="simple">
<li><p>clone the Cybex-P Archive repository</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/CYBEX-P/cybexp-report.git</span></code></p>
<ul class="simple">
<li><p>Install the requirements</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(example_name)$: cd cybexp-report
pip install -r requirements.txt
</pre></div>
</div>
<ul class="simple">
<li><p>Run the module</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(example_name)$: python3.9 report.py
</pre></div>
</div>
</div>
<div class="section" id="database-setup-and-installation-mongodb">
<h2>Database Setup and Installation (MongoDB)<a class="headerlink" href="#database-setup-and-installation-mongodb" title="Permalink to this headline">¶</a></h2>
<p>Cybex-P uses MongoDB as its relational database in storing and comparing threat data</p>
<p>As for setting up the database, all that is needed is a simple installation of MongoDB. The Cybex-P configuration settings and code will handle the rest at run-time.</p>
<p>To install MongoDB, execute the following commands:</p>
<ul class="simple">
<li><p>Install gnupg</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">gnupg</span>
</pre></div>
</div>
<ul class="simple">
<li><p>importing the MongoDB public GPG key</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="o">-</span><span class="n">qO</span> <span class="o">-</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">mongodb</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">static</span><span class="o">/</span><span class="n">pgp</span><span class="o">/</span><span class="n">server</span><span class="o">-</span><span class="mf">4.4</span><span class="o">.</span><span class="n">asc</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">key</span> <span class="n">add</span> <span class="o">-</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Appending mongodb to apt sources list</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;deb http://repo.mongodb.org/apt/debian buster/mongodb-org/4.4 main&quot;</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">tee</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">sources</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">mongodb</span><span class="o">-</span><span class="n">org</span><span class="o">-</span><span class="mf">4.4</span><span class="o">.</span><span class="n">list</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Updating the apt package list</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Installing the latest stable version of MongoDB</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">mongodb</span><span class="o">-</span><span class="n">org</span>
</pre></div>
</div>
<p>At this point your mongodb installation is complete, execute the following commands to initialize the mongodb systemd daemon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">mongod</span>
</pre></div>
</div>
<p>If the following prompt comes up:
<em><strong>Failed to start mongod.service: Unit mongod.service not found.</strong></em></p>
<p>Execute the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">daemon</span><span class="o">-</span><span class="n">reload</span>
</pre></div>
</div>
<p>Then run the systemctl start command again.</p>
<p>For any other concerns and additional functionality and support on MongoDB, consult the following <a class="reference external" href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-debian/">documentation</a>.</p>
</div>
<div class="section" id="cybex-p-database-overview">
<h2>Cybex-P Database Overview<a class="headerlink" href="#cybex-p-database-overview" title="Permalink to this headline">¶</a></h2>
<p>The ideal Cybex-P database setup contains 3 databases to handle everything:</p>
<ul class="simple">
<li><p>2 external databases located outside in the DMZ</p>
<ul>
<li><p>Cache data Lake</p></li>
<li><p>Identity database containing input configurations, users, organizations, and other backend identification data</p></li>
</ul>
</li>
<li><p>1 internal database</p>
<ul>
<li><p>The archive data base</p></li>
</ul>
</li>
</ul>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>graph TD
DMZ[DMZ / External]
NONDMZ[NON-DMZ / Internal]

CDL(Cache Data Lake) --&gt; DMZ
IDT(Identity Database) --&gt; DMZ
ACH(Archive Database) --&gt; NONDMZ

</pre></div>
</div>
</div>
<div class="section" id="systemd-services">
<h2>Systemd Services<a class="headerlink" href="#systemd-services" title="Permalink to this headline">¶</a></h2>
<p>Each Module of the Cybex-P backend has their own systemd Service file to handle execution and monitoring.</p>
<p>Below you will find a basic example of setting up the systemd service files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#This systemd file executes and maintains Cybex-P&#39;s Archive Module</span>

<span class="p">[</span><span class="n">Unit</span><span class="p">]</span>
<span class="n">Description</span><span class="o">=</span><span class="n">Cybex</span><span class="o">-</span><span class="n">P</span> <span class="n">archive</span> <span class="n">Module</span>
<span class="n">After</span><span class="o">=</span><span class="n">network</span><span class="o">-</span><span class="n">online</span><span class="o">.</span><span class="n">target</span>

<span class="p">[</span><span class="n">Service</span><span class="p">]</span>
<span class="n">User</span><span class="o">=</span><span class="n">cybexp</span><span class="o">-</span><span class="n">archive</span>
<span class="n">Group</span><span class="o">=</span><span class="n">cybexp</span><span class="o">-</span><span class="n">archive</span>
<span class="n">WorkingDirectory</span><span class="o">=../&lt;</span><span class="n">proj</span><span class="o">-</span><span class="nb">dir</span><span class="o">&gt;/</span><span class="n">archive</span>
<span class="n">Type</span><span class="o">=</span><span class="n">simple</span>
<span class="n">ExecStart</span><span class="o">=../</span><span class="n">cybexp</span><span class="o">/</span><span class="n">env</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python3</span> <span class="o">../&lt;</span><span class="n">project</span><span class="o">-</span><span class="nb">dir</span><span class="o">&gt;/</span><span class="n">archive</span><span class="o">/</span><span class="n">archive</span><span class="o">.</span><span class="n">py</span>

<span class="n">Restart</span><span class="o">=</span><span class="n">on</span><span class="o">-</span><span class="n">failure</span>
<span class="n">RestartSec</span><span class="o">=</span><span class="mi">5</span>

<span class="p">[</span><span class="n">Install</span><span class="p">]</span>
<span class="n">WantedBy</span><span class="o">=</span><span class="n">multi</span><span class="o">-</span><span class="n">user</span><span class="o">.</span><span class="n">target</span>

</pre></div>
</div>
<p>In the template above replace the following parameters with the indicated values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">../&lt;proj-dir&gt;/</span></code> - The full directory leading to where the module is stored</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">archive</span></code> - Name of the module for the systemd service file</p></li>
</ul>
<p>There should be 5 linux systemd service files that serve and maintain all of the Cybex-P Modules</p>
<div class="section" id="creating-the-service-files">
<h3>Creating the service files<a class="headerlink" href="#creating-the-service-files" title="Permalink to this headline">¶</a></h3>
<hr class="docutils" />
<p>To make the cybex-p systemd service files, simply do the following</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$: cd /etc/systemd/system
$: touch cybexp_archive.service
$: nano cybexp_archive.service
</pre></div>
</div>
<p>Replace the following to any appropriate name of the module you are constructing the systemd file for:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cybex_archive.service</span></code> - the name of whichever module’s systemd file is currently being created (E.G: <code class="docutils literal notranslate"><span class="pre">cybexp_api.service</span></code>)</p></li>
</ul>
<p>Then write in the template above and adjust accordingly to where your python3.9 cybex-p virtual environment and module is located</p>
</div>
<div class="section" id="executing-cybex-systemd-services">
<h3>Executing Cybex Systemd Services<a class="headerlink" href="#executing-cybex-systemd-services" title="Permalink to this headline">¶</a></h3>
<hr class="docutils" />
<p>Once all systemd service files have been provisioned to the Cybex-P modules. Run the following to command on all service files to execute the modules.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$: systemctl start ***
</pre></div>
</div>
<ul class="simple">
<li><p>Replacing <code class="docutils literal notranslate"><span class="pre">***</span></code> with the name of a module ( E.G: <code class="docutils literal notranslate"><span class="pre">cybex_archive</span></code> )</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Cybex-P_Report_Module.html" class="btn btn-neutral float-left" title="Cybex-P Report Module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Adam Cassell.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>